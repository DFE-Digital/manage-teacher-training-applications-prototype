{% extends "_layout.njk" %}

{% set primaryNavId = "statistics" %}
{% set sectionName = section | capitalize %}
{% set pageName = "Course performance" %}

{% block beforeContent %}
{{ govukBreadcrumbs({
  items: [{
    href: "/statistics",
    text: "Statistics"
  }, {
    text: pageName
  }]
}) }}
{% endblock %}

{% block content %}

{% include "_includes/statistics/header.njk" %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">

    <p class="govuk-body">
      <a class="govuk-link" href="/statistics/{{ section }}/{{ report }}/configure">Configure report</a>
    </p>

    {% if hasOptions %}
      {% include "_includes/statistics/selected-config-options.njk" %}
    {% endif %}

    <table class="govuk-table">
      <!-- <caption class="govuk-table__caption govuk-table__caption--m govuk-!-margin-top-5">{{ pageName }}</caption> -->
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th scope="col" class="govuk-table__header">Courses</th>
          <th scope="col" class="govuk-table__header">Applications sent offers</th>
          <th scope="col" class="govuk-table__header">Offers accepted</th>
          <th scope="col" class="govuk-table__header">Offers declined</th>
          <th scope="col" class="govuk-table__header">Offers deferred</th>
          <th scope="col" class="govuk-table__header">Applications withdrawn</th>
          <th scope="col" class="govuk-table__header">Applications rejected before interview</th>
          <th scope="col" class="govuk-table__header">Applications rejected after interview</th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        {% for subject in subjects %}
          {% if (data.subjectLevel and subject.level in data.subjectLevel) or (not data.subjectLevel.length) %}
            <tr class="govuk-table__row">
              <td scope="row" class="govuk-table__cell">{{ subject.name }} (AB{{ subject.code }})</td>
              <td class="govuk-table__cell">
                {{ ((subjectCounts[subject.name]['Offers sent'] / totalApplications) * 100) | numeral('0') + "%" }}
                {#{ subjectCounts[subject.name]['Offers sent'] }#}
              </td>
              <td class="govuk-table__cell">
                {{ ((subjectCounts[subject.name]['Offers accepted'] / subjectCounts[subject.name]['Offers sent']) * 100) | numeral('0') + "%" }}
              </td>
              <td class="govuk-table__cell">{{ ((subjectCounts[subject.name]['Offers declined'] / subjectCounts[subject.name]['Offers sent']) * 100) | numeral('0') + "%" }}</td>
              <td class="govuk-table__cell">{{ ((subjectCounts[subject.name]['Offers deferred'] / subjectCounts[subject.name]['Offers sent']) * 100) | numeral('0') + "%" }}</td>
              <td class="govuk-table__cell">{{ ((subjectCounts[subject.name]['Applications withdrawn'] / totalApplications) * 100) | numeral('0') + "%" }}</td>
              <td class="govuk-table__cell">{{ ((subjectCounts[subject.name]['Applications rejected before interview'] / totalApplications) * 100) | numeral('0') + "%" }}</td>
              <td class="govuk-table__cell">{{ ((subjectCounts[subject.name]['Applications rejected after interview'] / totalApplications) * 100) | numeral('0') + "%" }}</td>
            </tr>
          {% endif %}
        {% endfor %}
      </tbody>
    </table>

    <p class="govuk-body">
      <a class="govuk-link" href="#">Download <span class="govuk-visually-hidden">{{ pageName | lower }}</span> data</a>
    </p>

  </div>
</div>

{% endblock %}
