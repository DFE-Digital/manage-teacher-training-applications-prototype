{% extends "_content-wide.njk" %}

{% set title = "Applications" %}
{% set parent = "2019-20 recruitment cycle" %}

{% block primary %}
  {% set applications = applications | toArray %}
  {% set new = applications | filterBy("status", "new") %}
  {% set review = applications | filterBy("status", "review") %}
  {% set recruited = applications | filterBy("status", "recruited") %}
  {% set rejected = applications | filterBy("status", "rejected") %}

  {% if status == "new" %}
    {% set applications = new %}
  {% elif status == "review" %}
    {% set applications = review %}
  {% elif status == "recruited" %}
    {% set applications = recruited %}
  {% elif status == "rejected" %}
    {% set applications = rejected %}
  {% endif %}
  <table class="govuk-table" data-module="sortable-table">
    <thead class="govuk-table__head">
      <tr class="govuk-table__row">
        <th class="govuk-table__header" scope="col" aria-sort="none">Name</th>
        <th class="govuk-table__header govuk-!-width-one-third" scope="col" aria-sort="none">Course</th>
        <th class="govuk-table__header" scope="col">Status</th>
        <th class="govuk-table__header govuk-table__header--numeric" scope="col" aria-sort="descending">Received</th>
      {% if status == "recruited" or status == "rejected" %}
        <th class="govuk-table__header govuk-table__header--numeric" scope="col" aria-sort="none">{{ status | capitalize }}</th>
      {% else %}
        <th class="govuk-table__header govuk-table__header--numeric" scope="col" aria-sort="none">Reject by default</th>
      {% endif %}
      </tr>
    </thead>
    <tbody class="govuk-table__body">
    {% for a in applications | reverse %}
      {% set rbd = a.submitted | addDays(40) %}
      {% set remaining = rbd | daysFromNow(rbd) %}
      <tr class="govuk-table__row">
        <td class="govuk-table__cell">
          <a href="/application/{{ a.id }}">{{ [a["personal-details"]["given-name"], a["personal-details"]["family-name"]] | join(" ") }}</a>
        </td>
        <td class="govuk-table__cell">{{ a.course }}</td>
        <td class="govuk-table__cell">
          {{ govukTag({
            classes: "app-tag--" + a.status,
            text: a.status | statusName
          }) }}
        </td>
        <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ a.submitted | date("yyyyMMdd") }}">{{ a.submitted | date("d LLL yyyy") }}</td>
      {% if status == "recruited" %}
        <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ a.recruited | date("yyyyMMdd") }}">{{ a.recruited | date("d LLL yyyy") }}</td>
      {% elif status == "rejected" %}
        <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ a.rejected | date("yyyyMMdd") }}">{{ a.rejected | date("d LLL yyyy") }}</td>
      {% else %}
        <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ rbd | date("yyyyMMdd") }}">
        {% if a.status == "recruited" or a.status == "rejected" %}
          â€“
        {% else %}
          {{ rbd | date("d LLL yyyy") }} ({{ remaining }} days)
        {% endif %}
        </td>
      {% endif %}
      </tr>
    {% endfor %}
    </tbody>
  </table>
{% endblock %}
