{% extends "_content-wide.njk" %}

{% set primaryNavId = 'applications' %}
{% set title = "Applications" %}
{% set parent = "2019-20 recruitment cycle" %}

{% block primary %}

  <div class="moj-filter-layout">
    <div class="moj-filter-layout__filter">
      {% include "_includes/filter-panel.njk" %}
    </div>

    <div class="moj-filter-layout__content">
      <div class="moj-action-bar">
        <div class="moj-action-bar__filter"></div>
      </div>
      {# <div class="moj-scrollable-pane">
        <div class="moj-scrollable-pane__wrapper">
          {% if applications.length %}
            <table class="govuk-table" data-module="sortable-table">
              <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                  <th class="govuk-table__header" scope="col" aria-sort="none">Name</th>
                  <th class="govuk-table__header" scope="col" aria-sort="none">Course</th>
                  <th class="govuk-table__header" scope="col" aria-sort="none">Status</th>
                  <th class="govuk-table__header govuk-table__header--numeric" scope="col" aria-sort="descending">Last updated</th>
                </tr>
              </thead>
              <tbody class="govuk-table__body">
                {% for a in applications %}
                  {% set rbd = a.status.submitted.date | addDays(40) %}
                  {% set remaining = rbd | daysFromNow(rbd) %}
                  {% set updated = a.rejectedDate or a.offer.declinedDate or a.offer.acceptedDate or a.offer.madeDate or a.submittedDate %}
                  <tr class="govuk-table__row">
                    <td class="govuk-table__cell">
                      <a href="/application/{{ a.id }}">{{ [a["personal-details"]["given-name"], a["personal-details"]["family-name"]] | join(" ") }}</a>
                    </td>
                    <td class="govuk-table__cell">
                    <span class="govuk-caption-m govuk-!-font-size-16">{{ a.provider }}</span> {{ a.course }}</td>
                    <td class="govuk-table__cell">
                      {{ govukTag({
                        classes: a.status | statusClass,
                        text: a.status
                      })}}
                    </td>
                    <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ updated | date("yyyyMMdd") }}">{{ updated | date("d LLL yyyy") }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          {% endif%}
        </div>
      </div> #}

      <div>
        <div class="app-application-cards">
          {% if applications.length %}
            {% for a in applications %}
              {% set rbd = a.status.submitted.date | addDays(40) %}
              {% set remaining = rbd | daysFromNow(rbd) %}
              {% set updated = a.rejectedDate or a.offer.declinedDate or a.offer.acceptedDate or a.offer.madeDate or a.submittedDate %}
              {% include "_includes/application-card.njk" %}
            {% endfor %}
          {% endif%}
        </div>
      </div>

      {% if applications.length %}
        {{ mojPagination({
          results: {
            from: 1,
            to: 15,
            count: 30
          },
            next: {
            text: 'Next',
            href: ''
          },
            items: [{
            text: '1',
            href: '/page=1',
            selected: true
          }, {
            text: '2',
            href: '/page=2'
          }]
        }) }}
      {% endif %}

      {% if not applications.length %}
        <p>No applications for the selected filters.</p>
      {% endif %}
    </div>
  </div>
{% endblock %}

{% block pageScripts %}
  <script>
    new MOJFrontend.FilterToggleButton({
    bigModeMediaQuery: '(min-width: 48.063em)',
    startHidden: false,
    toggleButton: {
      container: $('.moj-action-bar__filter'),
      showText: 'Show filter',
      hideText: 'Hide filter',
      classes: 'govuk-button--secondary'
    },
    closeButton: {
      container: $('.moj-filter__header-action'),
      text: 'Close'
    },
    filter: {
      container: $('.moj-filter')
    }
  });
  </script>
{% endblock %}
