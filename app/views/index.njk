{% extends "_content-wide.njk" %}

{% set title = "Applications" %}
{% set parent = "2019-20 recruitment cycle" %}

{% block primary %}


  {% set filterOptionsHtml %}
    {{ govukCheckboxes({
      idPrefix: 'status',
      name: 'status',
      classes: "govuk-checkboxes--small",
      fieldset: {
        legend: {
          text: 'Status',
          classes: 'govuk-fieldset__legend--m'
        }
      },
      items: [
        {
          value: 'new',
          text: 'New',
          checked: checked("status", "new") == 'checked'
        },
        {
          value: 'offered',
          text: 'Offered',
          checked: checked("status", "offered") == 'checked'
        },
        {
          value: 'rejected',
          text: 'Rejected',
          checked: checked("status", "rejected") == 'checked'
        },
        {
          value: 'declined',
          text: 'Declined',
          checked: checked("status", "declined") == 'checked'
        },
        {
          value: 'accepted',
          text: 'Accepted',
          checked: checked("status", "accepted") == 'checked'
        }
      ]
    }) }}

    {{ govukCheckboxes({
      idPrefix: 'type',
      name: 'type',
      classes: "govuk-checkboxes--small",
      fieldset: {
        legend: {
          text: 'Provider',
          classes: 'govuk-fieldset__legend--m'
        }
      },
      items: [
        {
          value: '1',
          text: 'Blue',
          checked: false
        },
        {
          value: '2',
          text: 'Yellow',
          checked: false
        },
        {
          value: '3',
          text: 'Red'
        }
      ]
    }) }}
  {% endset %}

  <div class="moj-filter-layout">
    <div class="moj-filter-layout__filter">
      <div class="moj-filter" tabindex="-1">
        <div class="moj-filter__header">
          <div class="moj-filter__header-title">
            <h2 class="govuk-heading-m">Filter</h2>
          </div>
          <div class="moj-filter__header-action">

          </div>
        </div>
        <div class="moj-filter__content">
          <div class="moj-filter__options">
            <form method="get" action="/">
              <button class="govuk-button" data-module="govuk-button">
                Apply filters
              </button>
              {{filterOptionsHtml | safe}}
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="moj-filter-layout__content">
      <div class="moj-action-bar">
        <div class="moj-action-bar__filter"></div>
      </div>
      <div class="moj-scrollable-pane">
        <div class="moj-scrollable-pane__wrapper">
          <table class="govuk-table" data-module="sortable-tabe">
            <thead class="govuk-table__head">
              <tr class="govuk-table__row">
                <th class="govuk-table__header" scope="col" aria-sort="none">Name</th>
                <th class="govuk-table__header" scope="col" aria-sort="none">Course</th>
                <th class="govuk-table__header" scope="col" aria-sort="none">Provider</th>
                <th class="govuk-table__header" scope="col" aria-sort="none">Status</th>
                <th class="govuk-table__header govuk-table__header--numeric" scope="col" aria-sort="descending">Last updated</th>
              </tr>
            </thead>
            <tbody class="govuk-table__body">
              {% for a in applications %}
                {% set rbd = a.status.submitted.date | addDays(40) %}
                {% set remaining = rbd | daysFromNow(rbd) %}
                {% set updated = a.status.rejected.date or a.status.declined.date or a.status.accepted.date or a.status.offer.date or a.status.submitted.date %}
                <tr class="govuk-table__row">
                  <td class="govuk-table__cell">
                    <a href="/application/{{ a.id }}">{{ [a["personal-details"]["given-name"], a["personal-details"]["family-name"]] | join(" ") }}</a>
                  </td>
                  <td class="govuk-table__cell">{{ a.course }}</td>
                  <td class="govuk-table__cell">{{ a.provider }}</td>
                  <td class="govuk-table__cell">
                    {{ govukTag({
                      classes: "app-tag--" + a.status | status,
                      text: a.status | status | capitalize
                    }) }}
                  </td>
                  <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ a.submitted | date("yyyyMMdd") }}">{{ updated | date("d LLL yyyy") }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block pageScripts %}
  <script>
    new MOJFrontend.FilterToggleButton({
    bigModeMediaQuery: '(min-width: 48.063em)',
    startHidden: false,
    toggleButton: {
      container: $('.moj-action-bar__filter'),
      showText: 'Show filter',
      hideText: 'Hide filter',
      classes: 'govuk-button--secondary'
    },
    closeButton: {
      container: $('.moj-filter__header-action'),
      text: 'Close'
    },
    filter: {
      container: $('.moj-filter')
    }
  });
  {# new MOJFrontend.SortableTable({
    table: $('table')[0]
  }); #}
  </script>
{% endblock %}
