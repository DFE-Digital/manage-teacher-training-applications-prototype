{% extends "_layout.njk" %}

{% set primaryNavId = 'applications' %}

{% block content %}

  <span class="govuk-caption-xl">
    {{data.cycle}} recruitment cycle
  </span>
  <h1 class="govuk-heading-xl govuk-!-margin-bottom-2">
    Applications
  </h1>

  <p class="govuk-body govuk-!-margin-bottom-9">
    <a href="/change-cycle" class="govuk-link">Switch cycle</a>
  </p>

  <div class="moj-filter-layout">
    <div class="moj-filter-layout__filter">
      {% include "_includes/filter-panel.njk" %}
    </div>

    <div class="moj-filter-layout__content">

      <div class="moj-action-bar">
        <div class="moj-action-bar__filter"></div>
        <div>
          <form>
            <div class="govuk-form-group govuk-!-margin-bottom-2">
              <label class="govuk-label govuk-visually-hidden" for="sortby">Sorted by</label>
              <select class="govuk-select sortby-selector" name="sortby" id="sortby">
                <option value="last changed" {% if data.sortby == 'last changed' %} selected {% endif%}>Last changed</option>
                <option value="days left to respond" {% if data.sortby == 'days left to respond' %} selected {% endif%}>Days left to respond</option>
              </select>
              {{ govukButton({
                text: "Sort",
                classes: 'govuk-buton--secondary govuk-!-margin-bottom-2'
              }) }}
            </div>
          </form>

        </div>
      </div>
      <div>
        <div class="app-application-cards">
          {% if applications.length %}
            {% for a in applications %}
              {% set rbd = a.status.submitted.date | addDays(40) %}
              {% set remaining = rbd | daysFromNow(rbd) %}
              {% set updated = a.rejectedDate or a.offer.declinedDate or a.offer.acceptedDate or a.offer.madeDate or a.submittedDate %}
              {% include "_includes/application-card.njk" %}
            {% endfor %}
          {% endif%}
        </div>
      </div>

      {% if applications.length %}
        {{ mojPagination({
          results: {
            from: 1,
            to: 15,
            count: 30
          },
            next: {
            text: 'Next',
            href: ''
          },
            items: [{
            text: '1',
            href: '/page=1',
            selected: true
          }, {
            text: '2',
            href: '/page=2'
          }]
        }) }}
      {% endif %}

      {% if not applications.length %}
        <p>No applications for the selected filters.</p>
      {% endif %}
    </div>
  </div>
{% endblock %}

{% block pageScripts %}
  <script>
    new MOJFrontend.FilterToggleButton({
    bigModeMediaQuery: '(min-width: 48.063em)',
    startHidden: false,
    toggleButton: {
      container: $('.moj-action-bar__filter'),
      showText: 'Show filter',
      hideText: 'Hide filter',
      classes: 'govuk-button--secondary govuk-!-margin-bottom-0'
    },
    closeButton: {
      container: $('.moj-filter__header-action'),
      text: 'Close'
    },
    filter: {
      container: $('.moj-filter')
    }
  });
  </script>
{% endblock %}
