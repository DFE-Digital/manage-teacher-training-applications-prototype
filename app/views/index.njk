{% extends "_layout.njk" %}

{% set primaryNavId = 'applications' %}

{% block content %}

  <h1 class="govuk-heading-l">
    Applications
  </h1>


    <div class="app-filter-layout">
      <div class="app-filter-layout__filter">
        {% include "_includes/filter-panel.njk" %}
      </div>

      <div class="app-filter-layout__content">

        <div class="app-action-bar">
          <div class="app-action-bar__filter"></div>
        </div>
        <div>
          {% if applications.length %}

              <div class="app-application-cards">
                {% for a in applications %}
                  {% set rbd = a.status.submitted.date | addDays(40) %}
                  {% set remaining = rbd | daysFromNow(rbd) %}
                  {% set updated = a.rejectedDate or a.offer.declinedDate or a.offer.acceptedDate or a.offer.madeDate or a.submittedDate %}

                  {% if a.heading %}
                    <h2 class="govuk-heading-m app-application-cards__heading">{{a.heading}}</h2>
                  {% else %}
                    {% include "_includes/application-card.njk" %}
                  {% endif %}

                {% endfor %}
              </div>

          {% endif %}
        </div>

        {% if pagination %}
          {{ appPagination({
            results: {
              from: pagination.from,
              to: pagination.to,
              count: pagination.count
            },
            previous: pagination.previous,
            next: pagination.next,
            items: pagination.items
          }) }}
        {% endif %}

        {% if not applications.length %}
          <p>No applications for this cycle.</p>
        {% endif %}
      </div>
    </div>



{% endblock %}

{% block pageScripts %}
  <script src="/public/javascripts/modules/filter-toggle-button.js"></script>
  <script>
    new AppFrontend.FilterToggleButton({
      bigModeMediaQuery: '(min-width: 48.063em)',
      startHidden: false,
      toggleButton: {
        container: $('.app-action-bar__filter'),
        showText: 'Show filter',
        hideText: 'Hide filter',
        classes: 'govuk-button--secondary govuk-!-margin-bottom-3'
      },
      closeButton: {
        container: $('.app-filter__header-action'),
        text: 'Close'
      },
      filter: {
        container: $('.app-filter-layout__filter')
      }
    });
  </script>
{% endblock %}
