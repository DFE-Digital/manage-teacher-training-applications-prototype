{% extends "_content.njk" %}

{% set application = applications[applicationId] %}
{% set parent = "Application for " + application.course %}
{% set title = application.name %}
{% set hasSecondary = true %}

{% block pageNavigation %}
  {{ govukBreadcrumbs({
    items: [{
      text: "Applications",
      href: "/"
    }, {
      text: title
    }]
  }) }}
{% endblock %}

{% block primary %}
  <p class="govuk-body"><a href="/public/applications/{{ application.id }}.pdf">Download application</a></p>

  <h2 class="govuk-heading-m govuk-!-margin-bottom-2">Candidate details</h2>
  {{ govukSummaryList({
    rows: [{
      key: {
        text: "Full name"
      },
      value: {
        text: application.name
      }
    }, {
      key: {
        text: "Date of birth"
      },
      value: {
        text: application["date-of-birth"] | date("d LLLL yyyy")
      }
    }, {
      key: {
        text: "Nationality"
      },
      value: {
        text: application.nationality
      }
    }, {
      key: {
        text: "Email"
      },
      value: {
        html: "<a href=\"mailto:" + application["contact-details"].email + "\">" + application["contact-details"].email + "</a>"
      }
    }, {
      key: {
        text: "Phone"
      },
      value: {
        text: application["contact-details"].tel
      }
    }]
  }) }}

  <h2 class="govuk-heading-m govuk-!-margin-bottom-2">Qualifications</h2>
  {{ govukSummaryList({
    rows: [{
      key: {
        text: "Degree"
      },
      value: {
        text: application.qualifications.degree.type + ", " + application.qualifications.degree.subject + " – " + application.qualifications.degree.grade
      }
    }, {
      key: {
        text: "GCSEs"
      },
      value: {
        html: application.qualifications.maths.type + ", Maths " + " – " + application.qualifications.maths.grade + "<br>" + application.qualifications.english.type + ", English " + " – " + application.qualifications.english.grade
      }
    }]
  }) }}
{% endblock %}

{% block secondary %}
  <div class="app-card">
    <h2 class="govuk-heading-m">Status</h2>
    {{ govukTag({
      classes: "app-tag--" + application.status + " govuk-!-margin-bottom-4",
      text: application.status | capitalize
    }) }}
    <dl class="govuk-body">
      <dt class="govuk-!-font-weight-bold">Application submitted<dt>
      <dd class="govuk-!-margin-left-0">{{ application.submitted | date("dd LLL yyyy") }}</dd>
    </dl>

  {% if application.recruited %}
    <dl class="govuk-body">
      <dt class="govuk-!-font-weight-bold">Candidate recruited<dt>
      <dd class="govuk-!-margin-left-0">{{ application.recruited | date("dd LLL yyyy") }}</dd>
    </dl>
  {% elif application.rejected %}
    <dl class="govuk-body">
      <dt class="govuk-!-font-weight-bold">Candidate rejected<dt>
      <dd class="govuk-!-margin-left-0">{{ application.rejected | date("dd LLL yyyy") }}</dd>
    </dl>
  {% else %}
    {% set rbd = application.submitted | addDays(40) %}
    {% set remaining = rbd | daysFromNow(rbd) %}
    <dl class="govuk-body">
      <dt class="govuk-!-font-weight-bold">Rejected by default<dt>
      <dd class="govuk-!-margin-left-0">{{ rbd | date("dd LLL yyyy") }} ({{ remaining}} days time)</dd>
    </dl>
  {% endif %}

    {{ govukButton({
      classes: "govuk-!-margin-bottom-2",
      text: "Change status",
      href: "/application/" + application.id + "/change-status"
    }) }}
  </div>
{% endblock %}
