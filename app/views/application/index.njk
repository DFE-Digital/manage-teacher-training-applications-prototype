{% extends "_content-wide.njk" %}

{% set primaryNavId = 'applications' %}
{% set application = data.applications[applicationId] %}
{% set status = application.status %}
{% set name = [application["personal-details"]["given-name"], application["personal-details"]["family-name"]] | join(" ") %}
{% set title = name %}

{% block pageNavigation %}
  {{ govukBreadcrumbs({
    items: [{
      text: "Applications",
      href: "/"
    }, {
      text: title
    }]
  }) if not data.bare }}
{% endblock %}

{% block beforePageTitle %}
  {{ appBanner({
    html: "<h2 class=\"govuk-heading-m\">"+flash+"</h2>",
    type: "success",
    icon: false
  }) if flash }}

{% endblock %}

{% block primary %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

      {# <p class="govuk-body"><a href="">View application</a></p><br><br> #}

      <div class="app-card govuk-!-margin-bottom-9">
        {% if application.status == "Offered" %}
          <h2 class="govuk-heading-l">Offer made to {{name}}</h2>
        {% endif %}



        {% set rbd = application.submittedDate | addDays(40) %}
        {% set remaining = rbd | daysFromNow(rbd) %}

        {{ govukSummaryList({
          rows: [{
            key: {
              text: "Status"
            },
            value: {
              html: govukTag({
                classes: status | statusClass,
                text: status
              })
            }
          }, {
            key: {
              text: "Application submitted"
            },
            value: {
              text: application.submittedDate | date("dd LLL yyyy")
            }
          }, {
            key: {
              text: "Respond to applicant by"
            },
            value: {
              text: rbd | date("dd LLL yyyy")
            }
          } if not application.offer.madeDate,
          {
            key: {
              text: "Offer made"
            },
            value: {
              text: application.offer.madeDate | date("dd LLL yyyy")
            }
          } if application.offer.madeDate,
          {
            key: {
              text: "Offer accepted"
            },
            value: {
              text: application.offer.acceptedDate | date("dd LLL yyyy")
            }
          } if application.offer.acceptedDate,
          {
            key: {
              text: "Offer declined"
            },
            value: {
              text: application.offer.declinedDate | date("dd LLL yyyy")
            }
          } if application.offer.declinedDate,
          {
            key: {
              text: "Conditions met"
            },
            value: {
              text: application.offer.conditionsMetDate  | date("dd LLL yyyy")
            }
          } if application.offer.conditionsMetDate,
          {
            key: {
              text: "Application withdrawn"
            },
            value: {
              text: application.withdrawnDate  | date("dd LLL yyyy")
            }
          } if application.withdrawnDate,
          {
            key: {
              text: "Offer withdrawn"
            },
            value: {
              text: application.offer.withdrawnDate  | date("dd LLL yyyy")
            }
          } if application.offer.withdrawnDate,
          {
            key: {
              text: "Application rejected"
            },
            value: {
              text: application.rejectedDate  | date("dd LLL yyyy")
            }
          } if application.rejectedDate,
          {
            key: {
              text: "Course"
            },
            value: {
              html: '<span class="govuk-caption-m govuk-!-font-size-16">'+application.provider+'</span>'+ application.course
            },
            actions: {
              items: [
                {
                  href: "/application/${applicationId}/different-course",
                  text: "Change",
                  visuallyHiddenText: ""
                }
              ]
            } if application.status == "Offered"
          } if application.offer,
          {
            key: {
              text: "Location"
            },
            value: {
              html: 'Alliance Academy, Edgeware, Road Name, SW1 1AA'
            },
            actions: {
              items: [
                {
                  href: "/application/${applicationId}/different-course",
                  text: "Change",
                  visuallyHiddenText: ""
                }
              ]
            } if application.status == "Offered"
          } if application.offer
        ]})}}

        {# <h2 class="govuk-heading-m">Course details</h2> #}

        {# {{ govukSummaryList({
          rows: [{
            key: {
              text: "Course"
            },
            value: {
              html: application.course
            },
            actions: {
              items: [
                {
                  href: "#",
                  text: "Change",
                  visuallyHiddenText: "name"
                }
              ]
            }
          }, {
            key: {
              text: "Location"
            },
            value: {
              html: "Alliance Academy, Edgeware, Road Name, SW1 1AA"
            },
            actions: {
              items: [
                {
                  href: "#",
                  text: "Change",
                  visuallyHiddenText: "name"
                }
              ]
            }
          },
          {
            key: {
              text: "Provider"
            },
            value: {
              html: application.provider
            },
            actions: {
              items: [
                {
                  href: "#",
                  text: "Change",
                  visuallyHiddenText: "name"
                }
              ]
            }
          }]
        }) }} #}

        {% if application.offer and conditions %}

          <h2 class="govuk-heading-s">Conditions</h2>

          {# <p class="govuk-body"><a href="/application/{{applicationId}}/withdraw">Manage conditions</a></p> #}

          {{ govukTable({

            rows: [
              [
                {
                  text: "This is quite a long condition that could wrap onto more than one line."
                },
                {
                  html: govukTag({ text: 'Not met' if application.status != "Conditions met" and application.status != "Enrolled"  else "Met", classes: 'app-tag--grey' if application.status != "Conditions met" and application.status != "Enrolled" }),
                  format: "numeric"
                }
              ],
              [
                {
                  text: "This is a really really super long condition that could wrap onto more than one line."
                },
                {
                  html: govukTag({ text: 'Not met' if application.status != "Conditions met" and application.status != "Enrolled"  else "Met", classes: 'app-tag--grey' if application.status != "Conditions met" and application.status != "Enrolled" }),
                  format: "numeric"
                }
              ]
            ]
          }) }}
        {% endif %}

        {% if application.status == "Offered" %}
          <p class="govuk-body govuk-!-margin-bottom-0">
            <a href="/application/{{applicationId}}/withdraw">Withdraw offer</a>
          </p>
        {% endif %}

        {% if application.status == "Conditions met" %}
          {{govukButton({
            text: "Enrol candidate",
            href: "/application/" + application.id + "/confirm-enrollment"
          })}}

          <p class="govuk-body govuk-!-margin-bottom-0">
            <a href="#" class="app-withdraw-link">Cancel offer</a>
          </p>
        {% endif %}

        {% if application.status == 'New' %}
          {{govukButton({
            classes: "govuk-!-margin-bottom-0",
            text: "Respond to application",
            href: "/application/" + application.id + "/decision"
          })}}
        {% elseif application.status == 'Accepted' %}
          {{govukButton({
            classes: "govuk-!-margin-bottom-0",
            text: "Confirm conditions",
            href: "/application/" + application.id + "/mark-conditions"
          })}}
        {% endif %}

      </div>

      <div style="display: ">

        <h2 class="govuk-heading-l">Application</h2>

        {% include "_includes/application/details.njk" %}

        <h2 class="govuk-heading-m">Course details</h2>
        {{ govukSummaryList({
          rows: [{
            key: {
              text: "Provider"
            },
            value: {
              text: application["provider"]
            }
          }, {
            key: {
              text: "Course"
            },
            value: {
              text: application["course"]
            }
          }, {
            key: {
              text: "Cycle"
            },
            value: {
              text: '2020'
            }
          }, {
            key: {
              text: "Preferred location"
            },
            value: {
              text: 'Alliance Academy, Edgeware, Road Name, SW1 1AA'
            }
          }, {
            key: {
              text: "Study mode"
            },
            value: {
              text: 'Full time'
            }
          }]
        }) }}

        {% if conditions.length %}
          <h2 class="govuk-heading-m govuk-!-margin-top-8">Offer conditions</h2>

          {{appTaskList({
            items: conditions
          })}}
        {% endif %}

        <h2 class="govuk-heading-m govuk-!-margin-top-8">Accessibility needs</h2>
        {# <p class="govuk-body">(Question to candidate: “Your knowledge about the subject you want to teach”)</p> #}
        <p class="govuk-body">{{application["reasonable-adjustments"] | nl2br or "Not specified."}}</p>

        <h2 class="govuk-heading-m govuk-!-margin-top-8">Interview needs</h2>
        {# <p class="govuk-body">(Question to candidate: “Your knowledge about the subject you want to teach”)</p> #}
        <p class="govuk-body">{{application["personal-statement"].interview | nl2br or "Not specified."}}</p>

        <h2 class="govuk-heading-m govuk-!-margin-top-8">Qualifications</h2>
        {% include "_includes/application/degrees.njk" %}
        {% include "_includes/application/gcses.njk" %}
        {% include "_includes/application/other-qualifications.njk" %}

        <h2 class="govuk-heading-m govuk-!-margin-top-8">Work history</h2>
        {% include "_includes/application/work-history.njk" %}

        <h2 class="govuk-heading-m govuk-!-margin-top-8">School experience and volunteering</h2>
        {% include "_includes/application/school-experience.njk" %}

        <h2 class="govuk-heading-m govuk-!-margin-top-8">Language Skills</h2>
        {% include "_includes/application/language-skills.njk" %}

        <h2 class="govuk-heading-m govuk-!-margin-top-8">Personal statement</h2>
        {% include "_includes/application/personal-statement.njk" %}


        <h2 class="govuk-heading-m govuk-!-margin-top-8">Safeguarding</h2>
        {# <p class="govuk-body">We ask the candidate if they want to disclose anything before their DBS check.</p> #}
        <p class="govuk-body">{{application["suitability"] | nl2br or "Nothing disclosed"}}</p>

        <h2 class="govuk-heading-m govuk-!-margin-top-8 govuk-!-margin-bottom-2">First referee</h2>
        {% set referenceId = "first" %}
        {% include "_includes/application/reference.njk" %}

        <h2 class="govuk-heading-m govuk-!-margin-top-8 govuk-!-margin-bottom-2">Second referee</h2>
        {% set referenceId = "second" %}
        {% include "_includes/application/reference.njk" %}
      </div>
    </div>
  </div>
{% endblock %}
