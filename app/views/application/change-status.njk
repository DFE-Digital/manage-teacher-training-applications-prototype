{% extends "_form-wide.njk" %}

{% set application = applications[applicationId] %}
{% set formaction = "/application/" + application.id %}
{% set title = "Change status" %}

{% block pageNavigation %}
  {{ govukBackLink({
    href: "/application/" + application.id
  }) }}
{% endblock %}

{% block primary %}
  {% set isPrimaryCourse = application.course.includes("Primary") %}

  {% set currentStatusHtml %}
    {{ govukTag({
      classes: "app-tag--" + application.status,
      text: application.status | capitalize
    }) }}
  {% endset %}

  {{ govukSummaryList({
    rows: [{
      key: {
        text: "Candidate"
      },
      value: {
        text: application.name
      }
    }, {
      key: {
        text: "Course"
      },
      value: {
        text: application.course
      }
    }]
  }) }}

  {% set rejectedHtml %}
    {{ govukRadios({
      idPrefix: "status-rejected-eligibility",
      name: "status-rejected-reason",
      classes: "govuk-radios--small",
      fieldset: {
        legend: {
          text: "Reason for rejection",
          classes: "govuk-fieldset__legend--s"
        }
      },
      items: [{
        text: "Candidate did not have fundamental maths and English skills"
      }, {
        text: "Candidate did not have necessary maths qualifications"
      }, {
        text: "Candidate did not have necessary English qualifications"
      }, {
        text: ("Candidate did not have necessary science qualifications" if isPrimaryCourse else "Candidate did not have an appropriate level of subject knowledge")
      }, {
        text: "Candidate did not perform well at interview or assessment"
      }, {
        text: "Candidate did not attend interview or assessment"
      }, {
        text: "Candidate did not respond"
      }, {
        text: "Candidate withdrew their application"
      }, {
        text: "Training programme was full"
      }, {
        text: "Training programme was withdrawn"
      }, {
        divider: "or"
      }, {
        text: "Other"
      }]
    }) }}

    {{ govukTextarea({
      id: "status-rejected-comment",
      name: "status-rejected-comment",
      label: {
        text: "Comments",
        classes: "govuk-label--s"
      }
    }) }}
  {% endset %}

  {{ govukRadios({
    idPrefix: "status",
    name: "status",
    items: [{
      value: "new",
      text: "New",
      checked: application.status == "new"
    }, {
      value: "review",
      text: "In review",
      checked: application.status == "review"
    }, {
      value: "recruited",
      text: "Recruited",
      checked: application.status == "recruited"
    }, {
      value: "rejected",
      text: "Rejected",
      checked: application.status == "rejected",
      conditional: {
        html: rejectedHtml
      }
    }]
  }) }}

  {{ govukButton({
    text: "Change status"
  }) }}

  <p class="govuk-body"><a href="{{ formaction }}">Cancel</a></p>
{% endblock %}
