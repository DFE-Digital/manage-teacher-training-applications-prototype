<div class="app-activity-log__group">
  {%- for event in events %}
    {% set name = event.application.personalDetails.name %}

    {% if event.event.title == "Conditions met" %}
      {% set title = event.event.user + " marked " + name + "’s conditions as met"  %}
    {% elseif event.event.title == "Offer deferred" %}
      {% set title = event.event.user + " deferred " + name + "’s offer" %}
    {% elseif event.event.title == "Offer reconfirmed" %}
      {% set title = event.event.user + " reconfirmed " + name + "’s offer" %}
    {% elseif event.event.title == "Interview set up" %}
      {% set title = event.event.user + " set up an interview with " + name %}
    {% elseif event.event.title == "Interview cancelled" %}
      {% set title = event.event.user + " cancelled the interview with " + name %}
    {% elseif event.event.title == "Interview changed" %}
      {% set title = event.event.user + " changed the interview details for " + name %}
    {% elseif event.event.title == "Application submitted" %}
      {% set title = name + " submitted an application "  %}
    {% elseif event.event.title == "Application rejected automatically" %}
      {% set title = name + "’s application was rejected automatically" %}
    {% elseif event.event.title == "Application rejected" %}
      {% set title = event.event.user + " rejected " + name + "’s application"%}
    {% elseif event.event.title == "Offer accepted" %}
      {% set title = name + " accepted an offer"  %}
    {% elseif event.event.title == "Note added" %}
      {% set title = event.event.user + " added a note to " + name +"’s application" %}
    {% elseif event.event.title == "Offer declined" %}
      {% set title = name + " declined an offer " %}
    {% elseif event.event.title == "Offer made" %}
      {% set title = event.event.user + " made an offer to " + name  %}
    {% elseif event.event.title == "Offer changed" %}
      {% set title = event.event.user + " changed the offer for " + name +"’s application" %}
    {% elseif event.event.title == "Application withdrawn" %}
      {% set title = name + " withdrew their application" %}
    {% elseif event.event.title == "Conditions not met" %}
      {% set title = event.event.user + " marked " + name + "’s conditions as not met"  %}
    {% elseif event.event.title == "Offer withdrawn" %}
      {% set title = event.event.user + " withdrew " + name + "’s offer"  %}
    {% else %}
      {% set title = event.event.title %}
    {% endif -%}

    <div class="app-activity-log__item">
      <div class="app-activity-log__header">
        <h2 class="app-activity-log__title govuk-heading-s govuk-!-margin-bottom-1">
          {{ title }}
        </h2>
        <p class="app-activity-log__byline govuk-body-">
          <time datetime="{{ event.event.date | formatDate }}">
            {{- event.event.date | govukDateAtTime -}}
          </time>
        </p>
      </div>
      <div class="app-activity-log__description">

         {% if event.event.title == 'Note added' %}

          <div class="app-activity-log__box">
          {{ govukSummaryList({
            rows: [
              {
                key: {
                  text: "Training provider"
                },
                value: {
                  text: event.application.provider
                }
              },
              {
                key: {
                  text: "Course"
                },
                value: {
                  text: event.application.course
                }
              },
              {
                key: {
                  text: "Message"
                },
                value: {
                  text: event.event.meta.note.message | nl2br
                }
              },
              {
                key: {
                  text: "Sender"
                },
                value: {
                  text: event.event.meta.note.sender
                }
              }
            ]
          }) }}
          </div>

          <p class="app-log-card__note--link">
            <a class="govuk-link" href="/applications/{{event.application.id}}/notes/{{event.event.meta.note.id}}">
              View note
              <span class="govuk-visually-hidden">
                Candidate {{event.application.personalDetails.name}}
                Event date {{event.event.date | govukDateAtTime}}
              </span>
            </a>
          </p>

        {% endif %}

        {% if event.event.title == 'Interview cancelled' %}

          <div class="app-activity-log__box">
            {{appEventInterview({
              interview: event.event.meta.interview,
              cancellationReason: event.event.meta.cancellationReason
            })}}
          </div>

        {% endif %}


        {% if event.event.title == 'Interview changed' or event.event.title == 'Interview set up' %}

          <div class="app-activity-log__box">
            {{appEventInterview({ interview: event.event.meta.interview })}}
          </div>

        {% endif %}

        {% if event.event.title == "Conditions met" or event.event.title == "Conditions not met" or event.event.title == "Moved to next cycle" or event.event.title == "Offer withdrawn" or event.event.title == "Offer accepted" or event.event.title == "Offer made" or event.event.title == "Offer declined" or event.event.title == "Offer changed" or event.event.title == "Offer deferred" or event.event.title == "Offer reconfirmed" %}

          <div class="app-activity-log__box">
            {{appEventOffer({ offer: event.event.meta.offer })}}
          </div>

          {% if event.event.title == "Offer withdrawn" %}
            <p class="app-log-card__note--link"><a class="govuk-link" href="/applications/{{event.application.id}}/feedback">
              View feedback
              <span class="govuk-visually-hidden">
                Candidate {{event.application.personalDetails.name}}
                Event date {{event.event.date | govukDateAtTime}}
              </span>
            </a></p>
          {% else %}
            <p class="app-log-card__note--link"><a class="govuk-link" href="/applications/{{event.application.id}}/offer">
              View offer
              <span class="govuk-visually-hidden">
                Candidate {{event.application.personalDetails.name}}
                Event date {{event.event.date | govukDateAtTime}}
              </span>
            </a></p>
          {% endif %}

        {% endif %}

        {% if event.event.title == "Application submitted" or event.event.title == "Application withdrawn" or event.event.title == "Application rejected" %}

          <div class="app-activity-log__box">
          {{ govukSummaryList({
            rows: [
              {
                key: {
                  text: "Training provider"
                },
                value: {
                  text: event.application.provider
                }
              },
              {
                key: {
                  text: "Course"
                },
                value: {
                  text: event.application.course
                }
              },
              {
                key: {
                  text: "Location"
                },
                value: {
                  text: event.application.location
                }
              },
              {
                key: {
                  text: "Accredited body"
                },
                value: {
                  text: event.application.accreditedBody
                }
              }
            ]
          }) }}
          </div>

          {% if event.application.rejectedReasons %}
            <p class="app-log-card__note--link"><a class="govuk-link" href="/applications/{{event.application.id}}/feedback">
              View feedback
              <span class="govuk-visually-hidden">
                Candidate {{event.application.personalDetails.name}}
                Event date {{event.event.date | govukDateAtTime}}
              </span>
            </a></p>
          {% else %}
            <p class="app-log-card__note--link"><a class="govuk-link" href="/applications/{{event.application.id}}">
              View application
              <span class="govuk-visually-hidden">
                Candidate {{event.application.personalDetails.name}}
                Event date {{event.event.date | govukDateAtTime}}
              </span>
            </a></p>
          {% endif %}
        {% endif %}
      </div>
    </div>

  {% endfor %}
</div>
