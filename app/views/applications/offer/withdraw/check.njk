{% extends "_layout.njk" %}
{% from "_components/rejection-reasons/macro.njk" import rejectionReasons %}

{% set primaryNavId = 'applications' %}
{% set name = application.personalDetails.name %}

{% set heading = 'Check and confirm withdrawal' %}
{% set title = heading %}
{% set buttonText = 'Withdraw offer' %}

{% block pageNavigation %}
  {{ govukBackLink({
    href: "/applications/" + application.id + "/offer/withdraw/other-reasons-for-rejection/"
  }) }}
{% endblock %}

{% set withdrawalReasons %}

{% for reasonCategory in data['rejection']['categories'] %}
  <p class="govuk-body">{{reasonCategory}}</p>
  {% if reasonCategory == 'Qualifications' %}
    {% set reasons =  data['rejection']['qualifications-reasons'] %}
  {% else %}
    {% set reasons = null %}
  {% endif %}

  {% for reason in reasons %}
  <p class="govuk-body"> - {{reason}}{{reasonDetails}}</p>
  {% endfor %}

{% endfor %}


{% endset %}

{% block content %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <h1 class="govuk-heading-l">{{heading}}</h1>

      {% set showChangeLinks = true %}

      {{ govukSummaryList({
        rows: [
          {
            key: {
              text: "Full name"
            },
            value: {
              text: name
            }
          },
          {
            key: {
              text: "Course"
            },
            value: {
              text: application.course
            }
          },
          {
            key: {
              text: "Starting"
            },
            value: {
              text: '2025'
            }
          },
          {
            key: {
              text: "Preferred location"
            },
            value: {
              html: appLocation(application.location) if application.location.name else application.location
            }
          },
          {
            key: {
              text: "Reason for withdrawal"
            },
            value: {
              html: withdrawalReasons
            }
          }
        ]
      }) }}

      {{ govukWarningText({
        text: "We will tell the candidate you withdrew your offer, and share your reasons.",
        iconFallbackText: "Fallback text"
      }) }}

      <form method="post">
        {{ govukButton({
          text: buttonText,
          classes: "govuk-button--warning"
        }) }}
      </form>

      <p class="govuk-body"><a class="govuk-link--no-visited-state" href="/applications/{{ application.id }}/offer">Cancel</a></p>
    </div>
  </div>
{% endblock %}
