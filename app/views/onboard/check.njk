{% extends "_layout.njk" %}

{% block beforeContent %}
  {{ govukBackLink({
    href: "/onboard/" + lastRelationshipId
  }) }}
{% endblock %}

{% block content %}

  {% set tick %}
    {{ appIcon({
      icon: "check",
      hidden: true
    }) }}
  {% endset %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

      {% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}

      <span class="govuk-caption-l">Set up permissions</span>
      <h1 class="govuk-heading-l">Check permissions</h1>

      <form novalidate action="/onboard/confirmation">

        {% for item in relationships %}
          {# {% if relationships.length > 1 %} #}
            <h2 class="govuk-heading-m">
              {{ item.org.name }}
            </h2>
          {# {% endif %} #}


          {% for partner in item.partners %}

            {% set makeDecisionsHtml %}
              {% for item in data.onboard['a'+partner.id].makeDecisions %}
                <p>{{item}}</p>
              {% endfor %}
            {% endset %}

            {% set viewSafeguardingHtml %}
              {% for item in data.onboard['a'+partner.id].viewCriminalConvictions %}
                <p>{{item}}</p>
              {% endfor %}
            {% endset %}

            {% set viewDiversityHtml %}
              {% for item in data.onboard['a'+partner.id].viewDiversityInformation %}
                <p>{{item}}</p>
              {% endfor %}
            {% endset %}

            {% set cardHtml %}

              {{ govukSummaryList({
                rows: [
                  {
                    key: {
                      text: "Who can make decisions and set up interviews?"
                    },
                    value: {
                      html: makeDecisionsHtml
                    },
                    actions: {
                      items: [{
                        href: "/onboard/"+partner.id,
                        text: "Change"
                      }]
                    }
                  },
                  {
                    key: {
                      text: "Who can view safeguarding information?"
                    },
                    value: {
                      html: viewSafeguardingHtml
                    },
                    actions: {
                      items: [{
                        href: "/onboard/"+partner.id,
                        text: "Change"
                      }]
                    }
                  },
                  {
                    key: {
                      text: "Who can view diversity information?"
                    },
                    value: {
                      html: viewDiversityHtml
                    },
                    actions: {
                      items: [{
                        href: "/onboard/"+partner.id,
                        text: "Change"
                      }]
                    }
                  }
                ]
              }) }}
            {% endset %}


            {{appSummaryCard({
              titleText: item.org.name + ' and ' + partner.org.name,
              classes: "govuk-!-margin-bottom-6",
              html: cardHtml
            })}}
          {% endfor %}


        {% endfor %}

        {{govukButton({
          text: "Save permissions"
        })}}
      </form>
    </div>
  </div>

{% endblock %}
